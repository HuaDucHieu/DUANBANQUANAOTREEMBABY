/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package view;

import dao.ChiTietHoaDonDAO;
import dao.DanhMucDAO;
import dao.HoaDonDAO;
import dao.KhachHangDAO;
import dao.KichThuocDAO;
import dao.MauSacDAO;
import dao.SanPhamDAO;
import entity.ChiTietHoaDonEntity;
import entity.HoaDonEntity;
import entity.KhachHangEntity;
import entity.SanPhamEntity;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author duchi
 */
public class QuanLyChiTietHoaDonJPanel extends javax.swing.JPanel {

    HoaDonDAO hoaDonDAO = new HoaDonDAO();
    KhachHangDAO khachHangDAO = new KhachHangDAO();
    SanPhamDAO sanPhamDAO = new SanPhamDAO();
    ChiTietHoaDonDAO chiTietHoaDonDAO = new ChiTietHoaDonDAO();
    DanhMucDAO danhMucDAO = new DanhMucDAO();
    MauSacDAO mauSacDAO = new MauSacDAO();
    KichThuocDAO kichThuocDAO = new KichThuocDAO();

    // ‚úÖ Khai b√°o bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u h√≥a ƒë∆°n ƒëang ch·ªçn
    private int idHoaDonDangChon = -1; // -1 nghƒ©a l√† ch∆∞a ch·ªçn h√≥a ƒë∆°n n√†o

    /**
     * Creates new form ChiTietHoaDonJPanel
     */
    public QuanLyChiTietHoaDonJPanel() {
        initComponents();
        fillTableHoaDonCho();
        fillTableKhachHang();
        fillTableSanPham();

    }

    private void fillTableHoaDonCho() {
        DefaultTableModel model = (DefaultTableModel) tblHoaDonCho.getModel();
        model.setRowCount(0);
        List<HoaDonEntity> list = hoaDonDAO.getAll();
        for (HoaDonEntity hd : list) {
            model.addRow(new Object[]{
                hd.getIdHoaDon(),
                hd.getNgayLap(),
                hd.getTrangThai()
            });
        }
    }

    private void fillTableSanPham() {
        DefaultTableModel model = (DefaultTableModel) tblSanPham.getModel();
        model.setRowCount(0);

        List<SanPhamEntity> list = sanPhamDAO.getAllWithDetails();
        for (SanPhamEntity sp : list) {
            model.addRow(new Object[]{
                sp.getIdSp(),
                sp.getTenSp(),
                sp.getTenDanhMuc(),
                sp.getTenMauSac(),
                sp.getTenKichThuoc(),
                sp.getSoLuong(),
                sp.getGia(),
                sp.getTrangThai()
            });
        }
    }

    private void fillTableKhachHang() {
        DefaultTableModel model = (DefaultTableModel) tblKhachHang.getModel();
        model.setRowCount(0);
        List<KhachHangEntity> list = khachHangDAO.getAll();
        for (KhachHangEntity kh : list) {
            model.addRow(new Object[]{
                kh.getIdKhachHang(),
                kh.getHoTen(),
                kh.getSdt()
            });
        }
    }

    private void fillTableChiTietHoaDon() {
        DefaultTableModel model = (DefaultTableModel) tblChiTietHoaDon.getModel();
        model.setRowCount(0);

        // Ki·ªÉm tra ƒë√£ ch·ªçn h√≥a ƒë∆°n ch∆∞a
        if (idHoaDonDangChon == -1) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn h√≥a ƒë∆°n tr∆∞·ªõc!");
            return;
        }

        // L·∫•y danh s√°ch chi ti·∫øt h√≥a ƒë∆°n theo id h√≥a ƒë∆°n ƒëang ch·ªçn
        List<ChiTietHoaDonEntity> list = chiTietHoaDonDAO.getByIdHoaDon(idHoaDonDangChon);

        // T·∫°o DecimalFormat ƒë·ªÉ format s·ªë
        DecimalFormat df = new DecimalFormat("#,###");

        for (ChiTietHoaDonEntity ct : list) {
            double thanhTien = ct.getSoLuong() * ct.getDonGia();

            // Format ƒë∆°n gi√° v√† th√†nh ti·ªÅn
            String donGiaStr = df.format(ct.getDonGia());
            String thanhTienStr = df.format(thanhTien);

            model.addRow(new Object[]{
                ct.getIdChiTietHoaDon(),
                ct.getTenSanPham(),
                ct.getTenDanhMuc(),
                ct.getTenMauSac(),
                ct.getTenKichThuoc(),
                ct.getSoLuong(),
                donGiaStr,
                thanhTienStr
            });
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel7 = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblHoaDonCho = new javax.swing.JTable();
        btnTaoHoaDon = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        scrollPane1 = new java.awt.ScrollPane();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblKhachHang = new javax.swing.JTable();
        jPanel3 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        tblSanPham = new javax.swing.JTable();
        jLabel4 = new javax.swing.JLabel();
        txtTimKiem = new javax.swing.JTextField();
        btnTimKiem = new javax.swing.JButton();
        btnThemSanPham = new javax.swing.JButton();
        btnCapNhat = new javax.swing.JButton();
        jPanel4 = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        jScrollPane4 = new javax.swing.JScrollPane();
        tblChiTietHoaDon = new javax.swing.JTable();
        jPanel5 = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        txtTenKhachHang = new javax.swing.JTextField();
        txtSDT = new javax.swing.JTextField();
        BtnThemKH = new javax.swing.JButton();
        jPanel6 = new javax.swing.JPanel();
        jLabel10 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        jLabel13 = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();
        jLabel17 = new javax.swing.JLabel();
        txtSoLuong = new javax.swing.JTextField();
        txtTongTien = new javax.swing.JTextField();
        txtTienKhachDua = new javax.swing.JTextField();
        txtTienHoanLai = new javax.swing.JTextField();
        jComboBox1 = new javax.swing.JComboBox<>();
        txtNgayLap = new javax.swing.JTextField();
        btnXoaHoaDon = new javax.swing.JButton();
        btnThanhToan = new javax.swing.JButton();

        setBackground(new java.awt.Color(51, 51, 51));
        setForeground(new java.awt.Color(51, 51, 51));

        jLabel1.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        jLabel1.setText("H√≥a ƒë∆°n ch·ªù");

        tblHoaDonCho.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "ID h√≥a ƒë∆°n", "Ng√†y l·∫≠p", "Tr·∫°ng th√°i"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblHoaDonCho.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblHoaDonChoMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tblHoaDonCho);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 280, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(80, 80, 80)
                .addComponent(jLabel1)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 519, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        btnTaoHoaDon.setText("T·∫°o h√≥a ƒë∆°n");
        btnTaoHoaDon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTaoHoaDonActionPerformed(evt);
            }
        });

        jLabel2.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jLabel2.setText("Danh s√°ch Kh√°ch h√†ng ");

        tblKhachHang.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "ID kh√°ch h√†ng", "T√™n kh√°ch h√†ng", "S·ªë ƒëi·ªán tho·∫°i"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblKhachHang.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblKhachHangMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(tblKhachHang);

        scrollPane1.add(jScrollPane2);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(scrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addContainerGap(277, Short.MAX_VALUE))))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(scrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 129, Short.MAX_VALUE))
        );

        jLabel3.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jLabel3.setText("Danh s√°ch s·∫£n ph·∫©m");

        tblSanPham.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null}
            },
            new String [] {
                "ID s·∫£n ph·∫©m", "T√™n s·∫£n ph·∫©m", "Danh m·ª•c", "M√†u s·∫Øc", "K√≠ch th∆∞·ªõc ", "S·ªë l∆∞·ª£ng ", "ƒê∆°n gi√°"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblSanPham.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblSanPhamMouseClicked(evt);
            }
        });
        jScrollPane3.setViewportView(tblSanPham);

        jLabel4.setText("M√£ s·∫£n ph·∫©m");

        btnTimKiem.setText("T√¨m ki·∫øm");
        btnTimKiem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimKiemActionPerformed(evt);
            }
        });

        btnThemSanPham.setText("Th√™m");
        btnThemSanPham.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnThemSanPhamActionPerformed(evt);
            }
        });

        btnCapNhat.setText("C·∫≠p nh·∫≠t");
        btnCapNhat.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCapNhatActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addComponent(jLabel4)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtTimKiem, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimKiem)
                .addContainerGap(392, Short.MAX_VALUE))
            .addComponent(jScrollPane3, javax.swing.GroupLayout.Alignment.TRAILING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnThemSanPham)
                .addGap(44, 44, 44)
                .addComponent(btnCapNhat)
                .addGap(44, 44, 44))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(btnThemSanPham)
                    .addComponent(btnCapNhat))
                .addGap(18, 18, 18)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(txtTimKiem, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimKiem))
                .addGap(16, 16, 16)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 187, Short.MAX_VALUE))
        );

        jLabel5.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jLabel5.setText("Chi ti·∫øt h√≥a ƒë∆°n");

        tblChiTietHoaDon.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null}
            },
            new String [] {
                "ID s·∫£n ph·∫©m", "T√™n s·∫£n ph·∫©m", "Danh m·ª•c", "M√†u s·∫Øc", "K√≠ch th∆∞·ªõc", "S·ªë l∆∞·ª£ng b√°n", "ƒê∆°n gi√°", "Th√†nh ti·ªÅn"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane4.setViewportView(tblChiTietHoaDon);

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addComponent(jLabel5)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addComponent(jScrollPane4, javax.swing.GroupLayout.Alignment.TRAILING)
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel5)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 201, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jLabel6.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        jLabel6.setText("H√≥a ƒë∆°n");

        jLabel7.setText("Th√¥ng tin kh√°ch h√†ng:");

        jLabel8.setText("T√™n kh√°ch h√†ng");

        jLabel9.setText("S·ªë ƒëi·ªán tho·∫°i");

        BtnThemKH.setText("Th√™m ");
        BtnThemKH.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BtnThemKHActionPerformed(evt);
            }
        });

        jLabel10.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jLabel10.setText("Th√¥ng tin h√≥a ƒë∆°n:");

        jLabel11.setText("Ng√†y l·∫≠p");

        jLabel12.setText("S·ªë l∆∞·ª£ng sp");

        jLabel13.setText("T·ªïng ti·ªÅn");

        jLabel15.setText("Ph∆∞∆°ng th·ª©c tt");

        jLabel16.setText("Ti·ªÅn kh√°ch ƒë∆∞a");

        jLabel17.setText("Ti·ªÅn ho√†n l·∫°i");

        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Ti·ªÅn m·∫∑t", "Chuy·ªÉn kho·∫£n", "Qu·∫πt th·∫ª", " " }));

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel12)
                    .addComponent(jLabel13)
                    .addComponent(jLabel10)
                    .addGroup(jPanel6Layout.createSequentialGroup()
                        .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel16)
                            .addComponent(jLabel17)
                            .addComponent(jLabel15)
                            .addComponent(jLabel11))
                        .addGap(40, 40, 40)
                        .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(txtTongTien)
                            .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, 107, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtTienKhachDua)
                            .addComponent(txtSoLuong)
                            .addComponent(txtTienHoanLai)
                            .addComponent(txtNgayLap))))
                .addContainerGap(78, Short.MAX_VALUE))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel10)
                .addGap(30, 30, 30)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(txtNgayLap, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(20, 20, 20)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel12)
                    .addComponent(txtSoLuong, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(27, 27, 27)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(txtTongTien, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(27, 27, 27)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel15)
                    .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(24, 24, 24)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel16)
                    .addComponent(txtTienKhachDua, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(24, 24, 24)
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel17)
                    .addComponent(txtTienHoanLai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        btnXoaHoaDon.setText("X√≥a h√≥a ƒë∆°n");
        btnXoaHoaDon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXoaHoaDonActionPerformed(evt);
            }
        });

        btnThanhToan.setText("Thanh to√°n");
        btnThanhToan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnThanhToanActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel6)
                .addGap(124, 124, 124))
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addGap(23, 23, 23)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel8)
                            .addComponent(jLabel9))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(txtTenKhachHang, javax.swing.GroupLayout.DEFAULT_SIZE, 141, Short.MAX_VALUE)
                            .addComponent(txtSDT))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel7)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(BtnThemKH)))
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                .addComponent(btnXoaHoaDon, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                .addComponent(btnThanhToan, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addComponent(jLabel6)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(BtnThemKH))
                .addGap(18, 18, 18)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(txtTenKhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel9)
                    .addComponent(txtSDT, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(21, 21, 21)
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(33, 33, 33)
                .addComponent(btnXoaHoaDon, javax.swing.GroupLayout.PREFERRED_SIZE, 76, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(btnThanhToan, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(17, 17, 17))
        );

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(btnTaoHoaDon, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(18, 18, 18)
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, 21, Short.MAX_VALUE)
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addGap(42, 42, 42)
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel7Layout.createSequentialGroup()
                        .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel7Layout.createSequentialGroup()
                                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(jPanel7Layout.createSequentialGroup()
                                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(btnTaoHoaDon, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, Short.MAX_VALUE)))
                        .addContainerGap())))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btnTaoHoaDonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTaoHoaDonActionPerformed
        // TODO add your handling code here:
        HoaDonEntity hd = new HoaDonEntity();
        java.time.LocalDateTime now = java.time.LocalDateTime.now();
        hd.setNgayLap(now.toString());
        hd.setTrangThai("ƒêang x·ª≠ l√Ω");

        int id = hoaDonDAO.insertAndGetId(hd);
        if (id != -1) {
            JOptionPane.showMessageDialog(this, "T·∫°o h√≥a ƒë∆°n th√†nh c√¥ng! M√£: " + id);
            fillTableHoaDonCho();
        } else {
            JOptionPane.showMessageDialog(this, "T·∫°o h√≥a ƒë∆°n th·∫•t b·∫°i!");
        }
    }//GEN-LAST:event_btnTaoHoaDonActionPerformed

    private void btnXoaHoaDonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXoaHoaDonActionPerformed
        // TODO add your handling code here:
        int selectedRow = tblHoaDonCho.getSelectedRow();
        if (selectedRow == -1) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn h√≥a ƒë∆°n c·∫ßn h·ªßy!");
            return;
        }

        int idHoaDon = (int) tblHoaDonCho.getValueAt(selectedRow, 0);

        int confirm = JOptionPane.showConfirmDialog(this,
                "B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy h√≥a ƒë∆°n n√†y kh√¥ng?",
                "X√°c nh·∫≠n",
                JOptionPane.YES_NO_OPTION);
        if (confirm == JOptionPane.YES_OPTION) {
            HoaDonEntity hd = hoaDonDAO.getById(idHoaDon);
            if (hd != null) {
                hd.setTrangThai("H·ªßy");
                hoaDonDAO.update(hd);
                JOptionPane.showMessageDialog(this, "ƒê√£ h·ªßy h√≥a ƒë∆°n!");
                fillTableHoaDonCho();
            }
        }
    }//GEN-LAST:event_btnXoaHoaDonActionPerformed

    private void tblKhachHangMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblKhachHangMouseClicked
        // TODO add your handling code here:
        int row = tblKhachHang.getSelectedRow();
        if (row >= 0) {
            int idKH = (int) tblKhachHang.getValueAt(row, 0);
            String ten = (String) tblKhachHang.getValueAt(row, 1);
            String sdt = (String) tblKhachHang.getValueAt(row, 2);

            txtTenKhachHang.setText(ten);
            txtSDT.setText(sdt);
            txtTenKhachHang.setEditable(false); // kh√¥ng cho s·ª≠a n·∫øu l√† kh√°ch c≈©
            txtSDT.setEditable(false);

            JOptionPane.showMessageDialog(this, "ƒê√£ ch·ªçn kh√°ch h√†ng: " + ten);
        }
    }//GEN-LAST:event_tblKhachHangMouseClicked

    private void BtnThemKHActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BtnThemKHActionPerformed
        // TODO add your handling code here:
        String ten = JOptionPane.showInputDialog(this, "Nh·∫≠p t√™n kh√°ch h√†ng:");
        if (ten == null || ten.trim().isEmpty()) {
            JOptionPane.showMessageDialog(this, "T√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!");
            return;
        }

        String sdt = JOptionPane.showInputDialog(this, "Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i:");
        if (sdt == null || sdt.trim().isEmpty()) {
            JOptionPane.showMessageDialog(this, "SƒêT kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!");
            return;
        }

        // T·∫°o m·ªõi entity v√† l∆∞u v√†o DB
        KhachHangEntity kh = new KhachHangEntity();
        kh.setHoTen(ten);
        kh.setSdt(sdt);
        khachHangDAO.insert(kh);

        // C·∫≠p nh·∫≠t l·∫°i b·∫£ng
        fillTableKhachHang();

        // T·ª± ƒë·ªông ch·ªçn kh√°ch v·ª´a th√™m
        txtTenKhachHang.setText(ten);
        txtSDT.setText(sdt);
        JOptionPane.showMessageDialog(this, "ƒê√£ th√™m kh√°ch h√†ng m·ªõi th√†nh c√¥ng!");
    }//GEN-LAST:event_BtnThemKHActionPerformed

    private void btnTimKiemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimKiemActionPerformed
        // TODO add your handling code here:
        String input = txtTimKiem.getText().trim();
        if (input.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng nh·∫≠p m√£ s·∫£n ph·∫©m!");
            return;
        }

        try {
            int idSanPham = Integer.parseInt(input);
            SanPhamEntity sp = sanPhamDAO.findById(idSanPham);

            if (sp == null) {
                JOptionPane.showMessageDialog(this, "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m c√≥ m√£: " + idSanPham);
                return;
            }

            // X√≥a b·∫£ng c≈©, hi·ªÉn th·ªã s·∫£n ph·∫©m t√¨m ƒë∆∞·ª£c
            DefaultTableModel model = (DefaultTableModel) tblSanPham.getModel();
            model.setRowCount(0);
            model.addRow(new Object[]{
                sp.getIdSp(),
                sp.getTenSp(),
                sp.getTenDanhMuc(),
                sp.getTenMauSac(),
                sp.getTenKichThuoc(),
                sp.getGia(),
                sp.getSoLuong(),
                sp.getTrangThai()
            });

        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "M√£ s·∫£n ph·∫©m ph·∫£i l√† s·ªë!");
        }
    }//GEN-LAST:event_btnTimKiemActionPerformed

    private void btnThemSanPhamActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnThemSanPhamActionPerformed
        int row = tblSanPham.getSelectedRow();
        if (row < 0) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn s·∫£n ph·∫©m!");
            return;
        }

        // Ki·ªÉm tra xem ƒë√£ ch·ªçn h√≥a ƒë∆°n ch∆∞a
        if (idHoaDonDangChon == -1) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn h√≥a ƒë∆°n tr∆∞·ªõc!");
            return;
        }

        // L·∫•y th√¥ng tin s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn
        int idSanPham = Integer.parseInt(tblSanPham.getValueAt(row, 0).toString());
        String tenSanPham = tblSanPham.getValueAt(row, 1).toString();
        double gia = Double.parseDouble(tblSanPham.getValueAt(row, 6).toString());

        // H·ªèi ng∆∞·ªùi d√πng nh·∫≠p s·ªë l∆∞·ª£ng
        String soLuongStr = JOptionPane.showInputDialog(this, "Nh·∫≠p s·ªë l∆∞·ª£ng cho s·∫£n ph·∫©m: " + tenSanPham);
        if (soLuongStr == null || soLuongStr.trim().isEmpty()) {
            return;
        }

        int soLuong;
        try {
            soLuong = Integer.parseInt(soLuongStr);
            if (soLuong <= 0) {
                JOptionPane.showMessageDialog(this, "S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0!");
                return;
            }
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá!");
            return;
        }

        // L·∫•y s·∫£n ph·∫©m t·ª´ DB ƒë·ªÉ ki·ªÉm tra t·ªìn kho
        SanPhamEntity sp = sanPhamDAO.findById(idSanPham);
        if (sp == null) {
            JOptionPane.showMessageDialog(this, "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m trong c∆° s·ªü d·ªØ li·ªáu!");
            return;
        }

        // Ki·ªÉm tra xem s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i trong chi ti·∫øt h√≥a ƒë∆°n ch∆∞a
        ChiTietHoaDonEntity existingCT = chiTietHoaDonDAO.findByHoaDonAndSanPham(idHoaDonDangChon, idSanPham);

        boolean success = false;
        if (existingCT != null) {
            // C·ªông d·ªìn s·ªë l∆∞·ª£ng
            int soLuongMoi = existingCT.getSoLuong() + soLuong;

            // Ki·ªÉm tra t·ªìn kho
            if (soLuongMoi > sp.getSoLuong()) {
                JOptionPane.showMessageDialog(this,
                        "S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho! Ch·ªâ c√≤n " + sp.getSoLuong() + " s·∫£n ph·∫©m.");
                return;
            }

            existingCT.setSoLuong(soLuongMoi);
            existingCT.setDonGia(gia);

            success = chiTietHoaDonDAO.update2(existingCT);
            if (success) {
                JOptionPane.showMessageDialog(this, "‚úÖ ƒê√£ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong h√≥a ƒë∆°n!");
            } else {
                JOptionPane.showMessageDialog(this, "‚ùå C·∫≠p nh·∫≠t s·∫£n ph·∫©m th·∫•t b·∫°i!");
            }

        } else {
            // N·∫øu ch∆∞a c√≥ ‚Üí th√™m m·ªõi
            if (soLuong > sp.getSoLuong()) {
                JOptionPane.showMessageDialog(this,
                        "S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho! Ch·ªâ c√≤n " + sp.getSoLuong() + " s·∫£n ph·∫©m.");
                return;
            }

            ChiTietHoaDonEntity ct = new ChiTietHoaDonEntity();
            ct.setIdHoaDon(idHoaDonDangChon);
            ct.setIdSanPham(idSanPham);
            ct.setSoLuong(soLuong);
            ct.setDonGia(gia);

            success = chiTietHoaDonDAO.insert2(ct);
            if (success) {
                JOptionPane.showMessageDialog(this, "‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m m·ªõi v√†o h√≥a ƒë∆°n!");
            } else {
                JOptionPane.showMessageDialog(this, "‚ùå Th√™m s·∫£n ph·∫©m th·∫•t b·∫°i!");
            }
        }

        // C·∫≠p nh·∫≠t l·∫°i b·∫£ng chi ti·∫øt h√≥a ƒë∆°n
        fillTableChiTietHoaDon();
    }//GEN-LAST:event_btnThemSanPhamActionPerformed

    private void tblHoaDonChoMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblHoaDonChoMouseClicked
        int row = tblHoaDonCho.getSelectedRow();
        if (row >= 0) {
            // L·∫•y id_hoa_don t·ª´ b·∫£ng
            int idHoaDon = Integer.parseInt(tblHoaDonCho.getValueAt(row, 0).toString());

            // G√°n idHoaDon ƒëang ch·ªçn v√†o bi·∫øn to√†n c·ª•c
            idHoaDonDangChon = idHoaDon;

            // G·ªçi h√†m ƒë·ªÉ hi·ªÉn th·ªã chi ti·∫øt h√≥a ƒë∆°n
            fillTableChiTietHoaDon();

            // --- B·∫ÆT ƒê·∫¶U: Hi·ªÉn th·ªã th√¥ng tin kh√°ch h√†ng ---
            try {
                HoaDonEntity hd = hoaDonDAO.getById(idHoaDonDangChon);
                if (hd.getIdKhachHang() > 0) {
                    KhachHangEntity kh = khachHangDAO.getById(hd.getIdKhachHang());
                    txtTenKhachHang.setText(kh.getHoTen());
                    txtSDT.setText(kh.getSdt());
                } else {
                    txtTenKhachHang.setText("Ch∆∞a ch·ªçn");
                    txtSDT.setText("");
                }
            } catch (Exception ex) {
                ex.printStackTrace();
            }
            // --- K·∫æT TH√öC: Hi·ªÉn th·ªã th√¥ng tin kh√°ch h√†ng ---

            // Hi·ªÉn th·ªã th√¥ng b√°o ƒë√£ ch·ªçn h√≥a ƒë∆°n
            JOptionPane.showMessageDialog(this, "ƒê√£ ch·ªçn h√≥a ƒë∆°n: " + idHoaDonDangChon);

            // (t√πy ch·ªçn) debug tr√™n console
            System.out.println("H√≥a ƒë∆°n ƒëang ch·ªçn: " + idHoaDonDangChon);
        } else {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn m·ªôt h√≥a ƒë∆°n!");
        }
    }//GEN-LAST:event_tblHoaDonChoMouseClicked

    private void tblSanPhamMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblSanPhamMouseClicked
        int row = tblSanPham.getSelectedRow();
        if (row >= 0) {
            // L·∫•y t√™n s·∫£n ph·∫©m t·ª´ c·ªôt 1
            String tenSanPham = tblSanPham.getValueAt(row, 1).toString();

            // Hi·ªÉn th·ªã th√¥ng b√°o ƒë√£ ch·ªçn s·∫£n ph·∫©m
            JOptionPane.showMessageDialog(this, "ƒê√£ ch·ªçn s·∫£n ph·∫©m: " + tenSanPham);

            // (T√πy ch·ªçn) debug tr√™n console
            System.out.println("ƒê√£ ch·ªçn s·∫£n ph·∫©m: " + tenSanPham);
        } else {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn m·ªôt s·∫£n ph·∫©m!");
        }

    }//GEN-LAST:event_tblSanPhamMouseClicked

    private void btnCapNhatActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCapNhatActionPerformed
        int row = tblSanPham.getSelectedRow();
        if (row < 0) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn s·∫£n ph·∫©m ƒë·ªÉ c·∫≠p nh·∫≠t!");
            return;
        }

        try {
            // L·∫•y th√¥ng tin t·ª´ JTable
            int idSanPham = Integer.parseInt(tblSanPham.getValueAt(row, 0).toString());
            String tenSanPham = tblSanPham.getValueAt(row, 1).toString();
            String tenDanhMuc = tblSanPham.getValueAt(row, 2).toString();
            String tenMauSac = tblSanPham.getValueAt(row, 3).toString();
            String tenKichThuoc = tblSanPham.getValueAt(row, 4).toString();
            double donGia = Double.parseDouble(tblSanPham.getValueAt(row, 5).toString());

            // N·∫øu b·∫°n d√πng ID cho danh m·ª•c, m√†u s·∫Øc, k√≠ch th∆∞·ªõc, th√¨ c·∫ßn tra ID t·ª´ t√™n
            int idDanhMuc = danhMucDAO.findIdByName(tenDanhMuc);
            int idMauSac = mauSacDAO.findIdByName(tenMauSac);
            int idKichThuoc = kichThuocDAO.findIdByName(tenKichThuoc);

            // T·∫°o entity s·∫£n ph·∫©m
            SanPhamEntity sp = new SanPhamEntity();
            sp.setIdSp(idSanPham);
            sp.setTenSp(tenSanPham);
            sp.setIdDanhMuc(idDanhMuc);
            sp.setIdMauSac(idMauSac);
            sp.setIdKichThuoc(idKichThuoc);
            sp.setGia(donGia);

            // C·∫≠p nh·∫≠t v√†o DB
            boolean success = sanPhamDAO.update2(sp);
            if (success) {
                JOptionPane.showMessageDialog(this, "‚úÖ C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng!");
                fillTableSanPham(); // Load l·∫°i b·∫£ng
            } else {
                JOptionPane.showMessageDialog(this, "‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i!");
            }

        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá!");
        } catch (Exception e) {
            e.printStackTrace();
            JOptionPane.showMessageDialog(this, "C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t s·∫£n ph·∫©m!");
        }
    }//GEN-LAST:event_btnCapNhatActionPerformed

    private void btnThanhToanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnThanhToanActionPerformed
        //Ki·ªÉm tra ch·ªçn h√≥a ƒë∆°n
        if (idHoaDonDangChon == -1) {
            JOptionPane.showMessageDialog(this, "Vui l√≤ng ch·ªçn h√≥a ƒë∆°n tr∆∞·ªõc!");
            return;
        }

        // 2Ô∏è‚É£ L·∫•y chi ti·∫øt h√≥a ƒë∆°n
        List<ChiTietHoaDonEntity> listCT = chiTietHoaDonDAO.getByIdHoaDon(idHoaDonDangChon);
        if (listCT.isEmpty()) {
            JOptionPane.showMessageDialog(this, "H√≥a ƒë∆°n ch∆∞a c√≥ s·∫£n ph·∫©m!");
            return;
        }

        // 3Ô∏è‚É£ T√≠nh t·ªïng ti·ªÅn v√† t·ªïng s·ªë l∆∞·ª£ng
        double tongTien = 0;
        int tongSoLuong = 0;
        for (ChiTietHoaDonEntity ct : listCT) {
            tongTien += ct.getSoLuong() * ct.getDonGia();
            tongSoLuong += ct.getSoLuong();
        }

        // 4Ô∏è‚É£ Hi·ªÉn th·ªã ng√†y l·∫≠p, t·ªïng ti·ªÅn, t·ªïng s·ªë l∆∞·ª£ng
        java.util.Date ngayHienTai = new java.util.Date();
        txtNgayLap.setText(new java.text.SimpleDateFormat("dd/MM/yyyy").format(ngayHienTai));
        txtSoLuong.setText(String.valueOf(tongSoLuong));
        txtTongTien.setText(String.valueOf(tongTien));

        try {
            // 5Ô∏è‚É£ Nh·∫≠p ti·ªÅn kh√°ch ƒë∆∞a
            String strTienKhachDua = JOptionPane.showInputDialog(this, "Nh·∫≠p ti·ªÅn kh√°ch ƒë∆∞a:");
            if (strTienKhachDua == null) {
                return; // h·ªßy
            }
            double tienKhachDua = Double.parseDouble(strTienKhachDua);
            if (tienKhachDua < tongTien) {
                JOptionPane.showMessageDialog(this, "Ti·ªÅn kh√°ch ƒë∆∞a kh√¥ng ƒë·ªß!");
                return;
            }

            double tienThoi = tienKhachDua - tongTien;
            txtTienKhachDua.setText(String.valueOf(tienKhachDua));
            txtTienHoanLai.setText(String.valueOf(tienThoi));

            // 6Ô∏è‚É£ L·∫•y h√¨nh th·ª©c thanh to√°n
            String hinhThucTT = jComboBox1.getSelectedItem().toString();

            // 7Ô∏è‚É£ C·∫≠p nh·∫≠t h√≥a ƒë∆°n: tr·∫°ng th√°i + t·ªïng ti·ªÅn + h√¨nh th·ª©c thanh to√°n + ng√†y l·∫≠p
            HoaDonEntity hd = hoaDonDAO.getById(idHoaDonDangChon);
            hd.setTongTien(tongTien);
            hd.setHinhThucTT(hinhThucTT);
            hd.setTrangThai("ƒê√£ thanh to√°n"); // ‚úÖ ƒë√¢y l√† ch·ªó ƒë·ªïi tr·∫°ng th√°i
            hd.setNgayLap(new java.text.SimpleDateFormat("yyyy-MM-dd").format(ngayHienTai));
            hoaDonDAO.update(hd); // g·ªçi h√†m update trong DAO

            // 8Ô∏è‚É£ C·∫≠p nh·∫≠t t·ªìn kho
            for (ChiTietHoaDonEntity ct : listCT) {
                SanPhamEntity sp = sanPhamDAO.findById(ct.getIdSanPham());
                sp.setSoLuong(sp.getSoLuong() - ct.getSoLuong());
                sanPhamDAO.update2(sp);
            }

            // 9Ô∏è‚É£ Th√¥ng b√°o th√†nh c√¥ng
            JOptionPane.showMessageDialog(this, "‚úÖ Thanh to√°n th√†nh c√¥ng! Ti·ªÅn th·ªëi: " + tienThoi);

            // üîü Reload b·∫£ng ƒë·ªÉ tr·∫°ng th√°i ‚Äúƒê√£ thanh to√°n‚Äù hi·ªÉn th·ªã
            fillTableChiTietHoaDon(); // load chi ti·∫øt h√≥a ƒë∆°n
            fillTableSanPham();       // load t·ªìn kho s·∫£n ph·∫©m
            fillTableHoaDonCho();     // load l·∫°i h√≥a ƒë∆°n ch·ªù (ƒë√£ thanh to√°n s·∫Ω bi·∫øn m·∫•t)

        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Ti·ªÅn kh√°ch ƒë∆∞a kh√¥ng h·ª£p l·ªá!");
        }
    }//GEN-LAST:event_btnThanhToanActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BtnThemKH;
    private javax.swing.JButton btnCapNhat;
    private javax.swing.JButton btnTaoHoaDon;
    private javax.swing.JButton btnThanhToan;
    private javax.swing.JButton btnThemSanPham;
    private javax.swing.JButton btnTimKiem;
    private javax.swing.JButton btnXoaHoaDon;
    private javax.swing.JComboBox<String> jComboBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private java.awt.ScrollPane scrollPane1;
    private javax.swing.JTable tblChiTietHoaDon;
    private javax.swing.JTable tblHoaDonCho;
    private javax.swing.JTable tblKhachHang;
    private javax.swing.JTable tblSanPham;
    private javax.swing.JTextField txtNgayLap;
    private javax.swing.JTextField txtSDT;
    private javax.swing.JTextField txtSoLuong;
    private javax.swing.JTextField txtTenKhachHang;
    private javax.swing.JTextField txtTienHoanLai;
    private javax.swing.JTextField txtTienKhachDua;
    private javax.swing.JTextField txtTimKiem;
    private javax.swing.JTextField txtTongTien;
    // End of variables declaration//GEN-END:variables
}
